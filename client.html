<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ü—Ä–æ–∫—Å–∏ –ø–æ–¥–ø–∏—Å–∫–∞</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://yookassa.ru/checkout-widget/v1/checkout-widget.js"></script>
  <style>
    :root {
      --bg: #ffffff;
      --panel: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --accent: #2563eb;
      --danger: #dc2626;
      --ok: #16a34a;
      --border: rgba(15, 23, 42, 0.12);
      --shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
    }
    a { color: var(--accent); text-decoration: none; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 24px; }
    header { display:flex; justify-content: space-between; align-items: baseline; gap: 12px; margin-bottom: 16px; }
    h1 { font-size: 18px; margin: 0; }
    .sub { color: var(--muted); font-size: 13px; }
    .grid { display:grid; grid-template-columns: 1fr; gap: 14px; }
    @media (min-width: 900px) {
      .grid { grid-template-columns: repeat(12, 1fr); }
      .span-5 { grid-column: span 5; }
      .span-7 { grid-column: span 7; }
      .span-12 { grid-column: span 12; }
    }
    .card { background: var(--panel); border: 1px solid var(--border); border-radius: 14px; padding: 16px; box-shadow: var(--shadow); }
    .card h2 { font-size: 14px; margin: 0 0 10px 0; }
    .row { display: grid; grid-template-columns: 1fr; gap: 10px; }
    .row2 { display:grid; grid-template-columns: 1fr; gap: 10px; }
    @media (min-width: 600px) { .row2 { grid-template-columns: 1fr 1fr; } }
    label { display:block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    input[type="text"], input[type="email"] {
      width: 100%;
      background: #ffffff;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      color: var(--text);
      outline: none;
    }
    button {
      border: 1px solid var(--border);
      background: #ffffff;
      color: var(--text);
      padding: 10px 12px;
      border-radius: 10px;
      cursor: pointer;
    }
    button.primary { background: rgba(37,99,235,0.10); border-color: rgba(37,99,235,0.35); }
    button.danger { background: rgba(220,38,38,0.08); border-color: rgba(220,38,38,0.35); }
    button:disabled { opacity: 0.55; cursor: not-allowed; }
    .status { font-size: 12px; color: var(--muted); }
    .status.ok { color: var(--ok); }
    .status.err { color: var(--danger); }
    .note { font-size: 12px; color: var(--muted); margin-top: 8px; line-height: 1.35; }
    .plans { display:grid; grid-template-columns: 1fr; gap: 10px; margin-top: 10px; }
    @media (min-width: 700px) { .plans { grid-template-columns: 1fr 1fr 1fr; } }
    .plan { border: 1px solid var(--border); border-radius: 14px; padding: 12px; background: #f8fafc; }
    .plan.active { border-color: var(--accent); background: rgba(37,99,235,0.05); box-shadow: 0 0 0 2px rgba(37,99,235,0.1); }
    .plan .name { font-weight: 700; }
    .plan .price { margin-top: 6px; font-size: 13px; color: var(--muted); }
    code { background: #f1f5f9; padding: 2px 6px; border-radius: 8px; border: 1px solid var(--border); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .qr { display:grid; grid-template-columns: 1fr; gap: 12px; align-items: start; }
    @media (min-width: 520px) { .qr { grid-template-columns: 220px 1fr; } }
    .qr-box { width: 220px; height: 220px; border: 1px solid var(--border); border-radius: 10px; overflow: hidden; background:#fff; }
    .qr-box img { width: 220px; height: 220px; display:block; }
    table { width: 100%; border-collapse: collapse; }
    th, td { text-align: left; border-bottom: 1px solid var(--border); padding: 10px 8px; font-size: 13px; }
    th { color: var(--muted); font-weight: 600; }
    .right { text-align: right; }
    .actions { display:flex; flex-wrap: wrap; gap: 10px; align-items: center; margin-top: 12px; }
    footer {
      margin-top: 48px;
      padding: 24px 0;
      border-top: 1px solid var(--border);
      font-size: 12px;
      color: var(--muted);
      line-height: 1.5;
    }
    footer h3 {
      font-size: 14px;
      margin: 0 0 8px 0;
      color: var(--text);
    }
    footer .links {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    footer .links a {
      color: var(--accent);
    }
    footer .disclaimer {
      background: #f8fafc;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      margin-top: 16px;
    }
    footer .disclaimer h4 {
      font-size: 13px;
      margin: 0 0 8px 0;
      color: var(--text);
    }
    .faq-section {
      margin-top: 24px;
    }
    .faq-item {
      margin-bottom: 16px;
      padding: 12px;
      background: #f8fafc;
      border: 1px solid var(--border);
      border-radius: 10px;
    }
    .faq-question {
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text);
    }
    .faq-answer {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.4;
    }
    .order-card {
      background: #f8fafc;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
    }
    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .order-header h3 {
      margin: 0;
      font-size: 16px;
      color: var(--text);
    }
    .order-status {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    .order-status.pending {
      background: rgba(250, 204, 21, 0.1);
      color: #ca8a04;
    }
    .order-details {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .order-plan, .order-price {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .empty-state {
      text-align: center;
      padding: 40px 20px;
    }
    .empty-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }
    .empty-text {
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 4px;
    }
    .empty-subtext {
      font-size: 13px;
      color: var(--muted);
    }
    .proxy-card {
      background: #f8fafc;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      margin-top: 12px;
    }
    .proxy-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }
    .proxy-title {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    .proxy-icon {
      font-size: 32px;
    }
    .proxy-title h4 {
      margin: 0;
      font-size: 16px;
      color: var(--text);
    }
    .proxy-id {
      font-size: 12px;
      color: var(--muted);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    .proxy-status {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    .proxy-status.active {
      background: rgba(34, 197, 94, 0.1);
      color: #16a34a;
    }
    .proxy-status.expired {
      background: rgba(239, 68, 68, 0.1);
      color: #dc2626;
    }
    .subscription-info {
      background: white;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 16px;
    }
    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .info-row:last-child {
      margin-bottom: 0;
    }
    .info-row .label {
      font-size: 13px;
      color: var(--muted);
    }
    .info-row .value {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
    }
    .proxy-links {
      margin-bottom: 16px;
    }
    .links-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
      margin-top: 8px;
    }
    .link-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
    }
    .link-actions {
      display: flex;
      gap: 4px;
    }
    .link-mode {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    .link-btn {
      padding: 4px 8px;
      font-size: 12px;
    }
    .proxy-actions {
      display: flex;
      gap: 8px;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }
    .modal-content {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 24px;
      max-width: 500px;
      width: 100%;
      box-shadow: var(--shadow);
    }
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--text);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      z-index: 1000;
      animation: slideUp 0.3s ease;
    }
    .toast.ok {
      background: var(--ok);
    }
    .toast.err {
      background: var(--danger);
    }
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translate(-50%, 20px);
      }
      to {
        opacity: 1;
        transform: translate(-50%, 0);
      }
    }
  </style>
</head>
<body>
<div id="app" class="wrap">
  <header>
    <div>
      <h1>Tgoxy</h1>
    </div>
    <div class="status" :class="statusClass">{{ statusText }}</div>
  </header>

  <div class="grid">
    <section v-if="view === 'landing'" class="card span-12">
      <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ</h2>
      <div class="note">
        –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç–∞—Ä–∏—Ñ –∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à email –∏–ª–∏ Telegram username ‚Äî –º—ã –æ—Ç–ø—Ä–∞–≤–∏–º —Å—Å—ã–ª–∫—É –¥–ª—è –≤—Ö–æ–¥–∞.
      </div>

      <div class="plans">
        <div class="plan" :class="{ active: selectedPlan === 'week' }">
          <div class="name">–ù–µ–¥–µ–ª—è</div>
          <div class="price">‚ÇΩ100 / 7 –¥–Ω–µ–π</div>
          <div class="actions">
            <button class="primary" @click="selectPlan('week')" :disabled="busy">–í—ã–±—Ä–∞—Ç—å</button>
          </div>
        </div>
        <div class="plan" :class="{ active: selectedPlan === 'month' }">
          <div class="name">–ú–µ—Å—è—Ü</div>
          <div class="price">‚ÇΩ250 / 30 –¥–Ω–µ–π</div>
          <div class="actions">
            <button class="primary" @click="selectPlan('month')" :disabled="busy">–í—ã–±—Ä–∞—Ç—å</button>
          </div>
        </div>
        <div class="plan" :class="{ active: selectedPlan === 'year' }">
          <div class="name">–ì–æ–¥</div>
          <div class="price">‚ÇΩ2000 / 365 –¥–Ω–µ–π</div>
          <div class="actions">
            <button class="primary" @click="selectPlan('year')" :disabled="busy">–í—ã–±—Ä–∞—Ç—å</button>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:12px;">
        <div>
          <label>–î–ª—è –æ–ø–ª–∞—Ç—ã –≤–≤–µ–¥–∏—Ç–µ Email –∏–ª–∏ Telegram username</label>
          <input type="text" v-model.trim="auth.contact" placeholder="you@example.com –∏–ª–∏ @username" />
          <div class="note" v-if="authError" style="color: var(--danger); margin-top: 4px;">{{ authError }}</div>
        </div>
      </div>

      <div class="actions">
        <button class="primary" @click="startAuth" :disabled="!canContinue">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      </div>
    </section>

    <section v-if="view === 'confirm'" class="card span-12">
      <h2>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç</h2>

      <div class="note" v-if="deliveryText">{{ deliveryText }}</div>
      <div class="note" v-else>–°—Å—ã–ª–∫–∞ –¥–ª—è –≤—Ö–æ–¥–∞ —Å–æ–∑–¥–∞–Ω–∞.</div>

      <div class="note" v-if="delivery && delivery.telegram === 'sent'" style="margin-top:10px;">
        –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Telegram –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –¥–ª—è –≤—Ö–æ–¥–∞.
      </div>
      <div class="note" v-if="delivery && delivery.email === 'sent'" style="margin-top:10px;">
        –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –¥–ª—è –≤—Ö–æ–¥–∞.
      </div>

      <div v-if="tgStartUrl" class="note" style="margin-top:10px;">
        <div style="margin-top:6px;">–°—Å—ã–ª–∫–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ (–±–æ—Ç: <code class="mono">{{ tgBotLabel }}</code>):</div>
        <div class="mono" style="margin-top:6px; word-break: break-all;">{{ tgStartUrl }}</div>
        <div class="actions" style="margin-top:10px;">
          <button @click="openTgStart" :disabled="busy">–û—Ç–∫—Ä—ã—Ç—å Telegram</button>
          <button @click="copyTgStart" :disabled="busy">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
      </div>

      <div class="actions">
        <button @click="goLanding" :disabled="busy">–ù–∞–∑–∞–¥</button>
      </div>
    </section>

    <section v-if="view === 'landing'" class="card span-12 faq-section">
      <h2>–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã (FAQ)</h2>
      
      <div class="faq-item">
        <div class="faq-question">–ß—Ç–æ —Ç–∞–∫–æ–µ Tgoxy?</div>
        <div class="faq-answer">Tgoxy ‚Äî —ç—Ç–æ —Å–µ—Ä–≤–∏—Å MTProto –ø—Ä–æ–∫—Å–∏, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏ –±—ã—Å—Ç—Ä–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram, —É–ª—É—á—à–∞—è –∫–∞—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ —Å–Ω–∏–∂–∞—è –∑–∞–¥–µ—Ä–∂–∫–∏.</div>
      </div>
      
      <div class="faq-item">
        <div class="faq-question">–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–ø–ª–∞—Ç–∞?</div>
        <div class="faq-answer">–ú—ã –ø—Ä–∏–Ω–∏–º–∞–µ–º –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ YooKassa. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ç–∞—Ä–∏—Ñ–∞ –∏ –≤–≤–æ–¥–∞ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Å—Å—ã–ª–∫—É –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç, –≥–¥–µ —Å–º–æ–∂–µ—Ç–µ –æ–ø–ª–∞—Ç–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É.</div>
      </div>
      
      <div class="faq-item">
        <div class="faq-question">–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã?</div>
        <div class="faq-answer">–°—Ä–∞–∑—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –≤ –≤–∞—à–µ–º –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ø–æ—è–≤–∏—Ç—Å—è –ø—Ä–æ–∫—Å–∏-–∞–∫–∫–∞—É–Ω—Ç —Å —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–æ–π –∏ QR-–∫–æ–¥–æ–º –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram.</div>
      </div>
      
      <div class="faq-item">
        <div class="faq-question">–ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö?</div>
        <div class="faq-answer">–î–∞, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –ø—Ä–æ–∫—Å–∏-–∞–∫–∫–∞—É–Ω—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –õ–∏–º–∏—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ.</div>
      </div>
      
      <div class="faq-item">
        <div class="faq-question">–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø–∞–ª–æ?</div>
        <div class="faq-answer">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–∫—Å–∏ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∏—Ç—Å—è, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏.</div>
      </div>
    </section>

    <section v-if="view === 'cabinet'" class="card span-12">
      <h2>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>

      <div class="row2">
        <div>
          <label>–ö–ª–∏–µ–Ω—Ç</label>
          <div class="mono">id={{ me.client.id }}</div>
          <div class="mono" v-if="me.client.email">email={{ me.client.email }}</div>
          <div class="mono" v-if="me.client.tg_username">tg=@{{ me.client.tg_username }}</div>
        </div>
      </div>

      <div class="actions">
        <button @click="loadMe" :disabled="busy">–û–±–Ω–æ–≤–∏—Ç—å</button>
        <button class="danger" @click="logout" :disabled="busy">–í—ã–π—Ç–∏</button>
      </div>

      <div class="card" style="margin-top:12px; padding: 14px;">
        <h2 style="margin-bottom:8px;">–ü–æ–∫—É–ø–∫–∏ –∏ –æ–ø–ª–∞—Ç–∞</h2>
        <div class="note">–ö–∞–∂–¥—ã–π –ø—Ä–æ–∫—Å–∏-–∞–∫–∫–∞—É–Ω—Ç –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø–æ—è–≤–∏—Ç—Å—è –Ω–æ–≤—ã–π –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä.</div>

        <div class="actions">
          <button class="primary" :class="{'active-plan': me.orders && me.orders.length && me.orders[0].plan === 'week'}" @click="createOrder('week')" :disabled="busy">‚ÇΩ100 / –ù–µ–¥–µ–ª—è</button>
          <button class="primary" :class="{'active-plan': me.orders && me.orders.length && me.orders[0].plan === 'month'}" @click="createOrder('month')" :disabled="busy">‚ÇΩ250 / –ú–µ—Å—è—Ü</button>
          <button class="primary" :class="{'active-plan': me.orders && me.orders.length && me.orders[0].plan === 'year'}" @click="createOrder('year')" :disabled="busy">‚ÇΩ2000 / –ì–æ–¥</button>
        </div>

        <div v-if="!(me.orders && me.orders.length)" class="note" style="margin-top:10px;">–ù–µ—Ç –æ–∂–∏–¥–∞—é—â–∏—Ö –æ–ø–ª–∞—Ç.</div>

        <div v-else class="order-card" style="margin-top:12px;">
          <div class="order-header">
            <h3>–¢–µ–∫—É—â–∏–π –∑–∞–∫–∞–∑</h3>
            <span class="order-status" :class="me.orders[0].status">{{ me.orders[0].status === 'pending' ? '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' : me.orders[0].status }}</span>
          </div>
          <div class="order-details">
            <div class="order-plan">
              <span class="label">–¢–∞—Ä–∏—Ñ:</span>
              <span class="value">{{ getPlanName(me.orders[0].plan) }}</span>
            </div>
            <div class="order-price">
              <span class="label">–°—Ç–æ–∏–º–æ—Å—Ç—å:</span>
              <span class="value">{{ getPlanPrice(me.orders[0].plan) }}</span>
            </div>
          </div>
          <div class="actions" style="margin-top:16px;">
            <button class="primary" @click="payOrder(me.orders[0].id)" :disabled="busy">–û–ø–ª–∞—Ç–∏—Ç—å</button>
            <button class="danger" @click="cancelOrder" :disabled="busy">–û—Ç–º–µ–Ω–∏—Ç—å</button>
          </div>
          <div class="note" style="margin-top:12px;">–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π ‚Äî –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –¥—Ä—É–≥—É—é –∫–Ω–æ–ø–∫—É –≤—ã—à–µ.</div>
          <div class="note" style="margin-top:8px;">–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>
        </div>
      </div>

      <div v-if="payment.open" class="card" style="margin-top:12px; padding: 14px;">
        <h2 style="margin-bottom:8px;">–û–ø–ª–∞—Ç–∞</h2>
        <div id="yoo-widget-root" ref="yooWidget"></div>
        <div class="actions" style="margin-top:10px;">
          <button @click="closePayment" :disabled="busy">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
      </div>

      <div class="card" style="margin-top:12px; padding: 14px;">
        <h2 style="margin-bottom:8px;">–ü—Ä–æ–∫—Å–∏</h2>
        <div class="note">–ü—Ä–æ–∫—Å–∏-–∞–∫–∫–∞—É–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ. –£ –∫–∞–∂–¥–æ–≥–æ —Å–≤–æ–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–¥–ø–∏—Å–∫–∏.</div>

        <div v-if="!(me.proxy && me.proxy.accounts && me.proxy.accounts.length)" class="empty-state" style="margin-top:10px;">
          <div class="empty-icon">üì°</div>
          <div class="empty-text">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–≤</div>
          <div class="empty-subtext">–í—ã–±–µ—Ä–∏—Ç–µ –∏ –æ–ø–ª–∞—Ç–∏—Ç–µ —Ç–∞—Ä–∏—Ñ –≤—ã—à–µ, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π —Å–µ—Ä–≤–µ—Ä</div>
        </div>

        <div v-for="acc in (me.proxy.accounts || [])" :key="acc.id" class="proxy-card">
          <div class="proxy-header">
            <div class="proxy-title">
              <div class="proxy-icon">üîê</div>
              <div>
                <h4>–ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä</h4>
                <div class="proxy-id">ID: {{ acc.proxy_user }}</div>
              </div>
            </div>
            <div class="proxy-status" :class="acc.subscription && acc.subscription.status">
              {{ getStatusText(acc.subscription && acc.subscription.status) }}
            </div>
          </div>
          
          <div v-if="acc.subscription" class="subscription-info">
            <div class="info-row">
              <span class="label">–¢–∞—Ä–∏—Ñ:</span>
              <span class="value">{{ getPlanName(acc.subscription.plan) }}</span>
            </div>
            <div class="info-row">
              <span class="label">–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ:</span>
              <span class="value">{{ fmtTs(acc.subscription.ends_at) }}</span>
            </div>
          </div>
          
          <div v-if="(acc.links || []).length" class="proxy-links">
            <label>–°—Å—ã–ª–∫–∏ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</label>
            <div class="links-grid">
              <div v-for="l in acc.links" :key="acc.id + ':' + l.mode" class="link-item">
                <span class="link-mode">{{ l.mode }}</span>
                <div class="link-actions">
                  <button class="link-btn" @click="copyLink(l.link)" :disabled="busy">–°—Å—ã–ª–∫–∞</button>
                  <button class="link-btn" @click="openQr(l)" :disabled="busy">QR</button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="proxy-actions">
            <button class="primary" @click="confirmRecreateProxy(acc.id)" :disabled="busy || !(acc.subscription && acc.subscription.status === 'active')">
              –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–µ—Ä
            </button>
          </div>
        </div>
      </div>

    </section>

    <section v-if="view === 'cabinet'" class="card span-12 faq-section">
      <h2>–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã (FAQ)</h2>
      
      <div class="faq-item">
        <div class="faq-question">–ö–∞–∫ –ø—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É?</div>
        <div class="faq-answer">–í —Ä–∞–∑–¥–µ–ª–µ "–ü–æ–∫—É–ø–∫–∏ / –æ–ø–ª–∞—Ç–∞" –≤—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π —Ç–∞—Ä–∏—Ñ –∏ –Ω–∞–∂–º–∏—Ç–µ "–û–ø–ª–∞—Ç–∏—Ç—å". –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–ª–µ–Ω–∞.</div>
      </div>
      
      <div class="faq-item">
        <div class="faq-question">–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?</div>
        <div class="faq-answer">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–∫—Å–∏ —Å –ø–æ–º–æ—â—å—é –∫–Ω–æ–ø–∫–∏ "–ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å". –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.</div>
      </div>
      
      <div class="faq-item">
        <div class="faq-question">–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ?</div>
        <div class="faq-answer">–í—ã –º–æ–∂–µ—Ç–µ –∫—É–ø–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–∫—Å–∏ —Å –¥—Ä—É–≥–∏–º —Ç–∞—Ä–∏—Ñ–æ–º. –°—Ç–∞—Ä—ã–π –ø—Ä–æ–∫—Å–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞.</div>
      </div>
      
      <div class="faq-item">
        <div class="faq-question">–ì–¥–µ –Ω–∞–π—Ç–∏ –º–æ–∏ —Å—Å—ã–ª–∫–∏ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è?</div>
        <div class="faq-answer">–°—Å—ã–ª–∫–∏ –∏ QR-–∫–æ–¥—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü—Ä–æ–∫—Å–∏" –ø–æ–¥ –∫–∞–∂–¥—ã–º –≤–∞—à–∏–º –ø—Ä–æ–∫—Å–∏-–∞–∫–∫–∞—É–Ω—Ç–æ–º. –î–æ—Å—Ç—É–ø–Ω—ã —Ç—Ä–∏ —Ä–µ–∂–∏–º–∞: classic, secure, tls.</div>
      </div>
      
      <div class="faq-item">
        <div class="faq-question">–ö–∞–∫ –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É?</div>
        <div class="faq-answer">–ü–æ–¥–ø–∏—Å–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.</div>
      </div>
    </section>

  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ QR -->
  <div v-if="qr.open" class="modal-overlay" @click.self="closeQr">
    <div class="modal-content">
      <h2 style="margin: 0 0 16px 0;">QR-–∫–æ–¥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
      <div class="qr">
        <div class="qr-box" ref="qrBox"></div>
        <div>
          <label>–°—Å—ã–ª–∫–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</label>
          <input type="text" class="mono" :value="qr.link" readonly />
          <div class="actions" style="margin-top: 12px;">
            <button class="primary" @click="copyQrLink" :disabled="busy || !qr.link">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button @click="closeQr" :disabled="busy">–ó–∞–∫—Ä—ã—Ç—å</button>
          </div>
          <div class="note" style="margin-top: 12px;">–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –≤ Telegram –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</div>
        </div>
      </div>
    </div>
  </div>

  <div v-if="toast.show" class="toast" :class="toast.type">
    {{ toast.text }}
  </div>

  <footer>
    <div class="links">
      <a href="#" @click.prevent>–ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞</a>
      <a href="#" @click.prevent>–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
      <a href="#" @click.prevent>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
    </div>
    
    <div class="disclaimer">
      <h4>–ü–æ–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞:</h4>
      –£—Å–ª—É–≥–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ ping, —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è jitter) –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ª–µ–≥–∞–ª—å–Ω—ã–º–∏ –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏.<br><br>
      <strong>–ó–∞–ø—Ä–µ—â–µ–Ω–æ:</strong> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —à–ª—é–∑–æ–≤ –¥–ª—è —Å–æ–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ç–∏–≤–æ–ø—Ä–∞–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–≥–æ –ü–û, —Å–ø–∞–º–∞, –∞ —Ç–∞–∫–∂–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –†–§ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º. –ü—Ä–∏ –≤—ã—è–≤–ª–µ–Ω–∏–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤.
    </div>
    
    <div style="margin-top: 16px; text-align: center;">
      2024 Tgoxy. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
    </div>
  </footer>
</div>

<script>
const { createApp } = Vue

createApp({
  data() {
    return {
      busy: false,
      statusText: "",
      statusKind: "",
      view: "landing",
      selectedPlan: "week",
      auth: { contact: "" },
      devLink: "",
      tgStartUrl: "",
      tgBot: "",
      delivery: { email: "", telegram: "" },
      me: null,
      qr: { open: false, link: "" },
      payment: { open: false, orderId: 0, widget: null },
      toast: { show: false, text: "", type: "" }
    }
  },
  computed: {
    statusClass() {
      if (this.statusKind === 'ok') return 'ok'
      if (this.statusKind === 'err') return 'err'
      return ''
    }
    ,
    tgBotLabel() {
      const b = (this.tgBot || '').trim()
      if (!b) return '@your_bot'
      if (b.startsWith('@')) return b
      return '@' + b
    },
    authError() {
      if (!this.auth.contact) return ""
      const isEmail = this.auth.contact.includes('@') && !this.auth.contact.startsWith('@')
      const isTelegram = this.auth.contact.startsWith('@') && this.auth.contact.length > 1
      if (!isEmail && !isTelegram) {
        return "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email (you@example.com) –∏–ª–∏ Telegram username (@username)"
      }
      return ""
    },
    canContinue() {
      return !this.busy && this.selectedPlan && this.auth.contact && !this.authError
    },
    deliveryText() {
      const d = this.delivery || {}
      const em = d.email || ''
      const tg = d.telegram || ''
      if (em === 'sent') return '–°—Å—ã–ª–∫–∞ –¥–ª—è –≤—Ö–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –ø–æ—á—Ç—É.'
      if (tg === 'sent') return '–°—Å—ã–ª–∫–∞ –¥–ª—è –≤—Ö–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ Telegram.'
      if (em === 'failed' && tg === 'failed') return '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∏ –Ω–∞ –ø–æ—á—Ç—É, –Ω–∏ –≤ Telegram. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π dev-—Å—Å—ã–ª–∫—É (–≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏).'
      if (em === 'failed') return '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—á—Ç—É. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.'
      if (tg === 'failed') return '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –≤ Telegram. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.'
      return ''
    }
  },
  methods: {
    setStatus(kind, text) {
      this.statusKind = kind
      this.statusText = text
    },
    async apiFetch(path, opts) {
      const headers = { "Content-Type": "application/json" }
      const res = await fetch(path, { headers, credentials: 'include', ...opts })
      const ct = res.headers.get('content-type') || ''
      let body = null
      if (ct.includes('application/json')) body = await res.json()
      else body = await res.text()
      if (!res.ok) {
        const detail = body && body.detail ? body.detail : body
        throw new Error(typeof detail === 'string' ? detail : JSON.stringify(detail))
      }
      return body
    },
    selectPlan(p) {
      this.selectedPlan = p
      this.setStatus('', '')
    },
    goLanding() {
      this.view = 'landing'
      this.setStatus('', '')
    },
    validateContact() {
      // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ computed —Å–≤–æ–π—Å—Ç–≤–æ authError
    },
    async startAuth() {
      this.busy = true
      try {
        this.devLink = ""
        this.tgStartUrl = ""
        this.tgBot = ""
        this.delivery = { email: "", telegram: "" }
        const payload = { plan: this.selectedPlan, email: "", tg_username: "" }
        const isEmail = this.auth.contact.includes('@') && !this.auth.contact.startsWith('@')
        if (isEmail) {
          payload.email = this.auth.contact
        } else {
          payload.tg_username = this.auth.contact
        }
        const resp = await this.apiFetch('/client/auth/start', { method: 'POST', body: JSON.stringify(payload) })
        this.devLink = resp.dev_link || ""
        this.tgStartUrl = resp.tg_start_url || ""
        this.tgBot = resp.tg_bot || ""
        this.delivery = resp.delivery || { email: "", telegram: "" }
        this.view = 'confirm'
        this.setStatus('ok', '–û—Ç–ø—Ä–∞–≤–∏–ª–∏ —Å—Å—ã–ª–∫—É –¥–ª—è –≤—Ö–æ–¥–∞')
      } catch (e) {
        this.setStatus('err', '–û—à–∏–±–∫–∞: ' + e.message)
      } finally {
        this.busy = false
      }
    },
    openTgStart() {
      if (this.tgStartUrl) window.open(this.tgStartUrl, '_blank')
    },
    async copyTgStart() {
      try {
        await navigator.clipboard.writeText(this.tgStartUrl)
        this.showToast('–°—Å—ã–ª–∫–∞ Telegram —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞', 'ok')
      } catch (e) {
        this.showToast('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', 'err')
      }
    },
    openDevLink() {
      if (this.devLink) window.location.href = this.devLink
    },
    async copyDevLink() {
      try {
        await navigator.clipboard.writeText(this.devLink)
        this.showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞', 'ok')
      } catch (e) {
        this.showToast('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', 'err')
      }
    },
    async loadMe() {
      this.busy = true
      try {
        const me = await this.apiFetch('/client/me', { method: 'GET' })
        this.me = me
        this.view = 'cabinet'
        this.setStatus('ok', '–ì–æ—Ç–æ–≤–æ')
      } catch (e) {
        this.setStatus('err', '–û—à–∏–±–∫–∞: ' + e.message)
      } finally {
        this.busy = false
      }
    },
    fmtTs(ts) {
      try {
        return new Date(ts * 1000).toISOString().replace('T', ' ').replace('Z', '')
      } catch (e) {
        return String(ts)
      }
    },
    async createOrder(plan) {
      this.busy = true
      this.closePayment() // Close payment widget on order change
      try {
        const resp = await this.apiFetch('/client/proxy/create', { method: 'POST', body: JSON.stringify({ plan: plan }) })
        this.setStatus('ok', '–°–æ–∑–¥–∞–ª–∏ –∑–∞–∫–∞–∑ –Ω–∞ –æ–ø–ª–∞—Ç—É')
        await this.loadMe()
      } catch (e) {
        this.setStatus('err', '–û—à–∏–±–∫–∞: ' + e.message)
      } finally {
        this.busy = false
      }
    },
    async payOrder(orderId) {
      this.busy = true
      try {
        const resp = await this.apiFetch('/client/payment/create', { method: 'POST', body: JSON.stringify({ subscription_id: orderId }) })
        const token = resp.confirmation_token
        const paymentId = resp.payment_id
        if (!token) throw new Error('no confirmation_token')
        if (!paymentId) throw new Error('no payment_id')
        this.payment.open = true
        this.payment.orderId = orderId
        await this.$nextTick()
        const root = this.$refs.yooWidget
        if (!root) throw new Error('widget root not found')
        root.innerHTML = ''
        if (typeof YooMoneyCheckoutWidget === 'undefined') throw new Error('YooKassa widget not loaded')
        this.payment.widget = new YooMoneyCheckoutWidget({
          confirmation_token: token,
          error_callback: (err) => {
            try {
              const msg = (err && (err.description || err.message)) ? (err.description || err.message) : JSON.stringify(err)
              this.setStatus('err', '–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã: ' + msg)
            } catch (e) {
              this.setStatus('err', '–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã')
            }
          },
        })

        this.payment.widget.on('success', async () => {
          try {
            await this.apiFetch('/client/payment/complete', { method: 'POST', body: JSON.stringify({ payment_id: paymentId }) })
            this.setStatus('ok', '–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞. –ü—Ä–æ–∫—Å–∏ —Å–æ–∑–¥–∞–Ω.')
            this.closePayment()
            await this.loadMe()
          } catch (e) {
            this.setStatus('err', '–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞, –Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å: ' + e.message)
          } finally {
            try { this.payment.widget && this.payment.widget.destroy && this.payment.widget.destroy() } catch (e) {}
          }
        })

        this.payment.widget.on('fail', () => {
          this.setStatus('err', '–û–ø–ª–∞—Ç–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞')
          try { this.payment.widget && this.payment.widget.destroy && this.payment.widget.destroy() } catch (e) {}
        })

        this.payment.widget.render('yoo-widget-root')
        this.setStatus('ok', '–û—Ç–∫—Ä—ã–ª —Ñ–æ—Ä–º—É –æ–ø–ª–∞—Ç—ã')
      } catch (e) {
        this.setStatus('err', '–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã: ' + e.message)
      } finally {
        this.busy = false
      }
    },
    closePayment() {
      try {
        if (this.payment.widget && this.payment.widget.destroy) this.payment.widget.destroy()
      } catch (e) {}
      this.payment.widget = null
      this.payment.open = false
      this.payment.orderId = 0
    },
    async cancelOrder() {
      this.busy = true
      this.closePayment() // Close payment widget on order cancellation
      try {
        await this.apiFetch('/client/order/cancel', { method: 'POST', body: '{}' })
        this.setStatus('ok', '–ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω—ë–Ω')
        await this.loadMe()
      } catch (e) {
        this.setStatus('err', '–û—à–∏–±–∫–∞: ' + e.message)
      } finally {
        this.busy = false
      }
    },
    async recreateProxy(accountId) {
      this.busy = true
      try {
        await this.apiFetch('/client/proxy/recreate', { method: 'POST', body: JSON.stringify({ account_id: accountId }) })
        await this.loadMe()
        this.setStatus('ok', '–ü—Ä–æ–∫—Å–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω')
      } catch (e) {
        this.setStatus('err', '–û—à–∏–±–∫–∞: ' + e.message)
      } finally {
        this.busy = false
      }
    },
    async deleteProxy(accountId) {
      this.busy = true
      try {
        await this.apiFetch('/client/proxy/' + accountId, { method: 'DELETE' })
        await this.loadMe()
        this.setStatus('ok', '–ü—Ä–æ–∫—Å–∏ —É–¥–∞–ª—ë–Ω')
      } catch (e) {
        this.setStatus('err', '–û—à–∏–±–∫–∞: ' + e.message)
      } finally {
        this.busy = false
      }
    },
    openQr(l) {
      this.qr.open = true
      this.qr.link = l.link
      this.$nextTick(() => {
        this.renderQr()
      })
    },
    closeQr() {
      this.qr.open = false
      this.qr.link = ''
    },
    async renderQr() {
      try {
        if (!this.qr.link) return
        const box = this.$refs.qrBox
        if (!box) return
        while (box.firstChild) box.removeChild(box.firstChild)
        new QRCode(box, { text: this.qr.link, width: 220, height: 220, correctLevel: QRCode.CorrectLevel.M })
      } catch (e) {
        this.showToast('QR –æ—à–∏–±–∫–∞: ' + e.message, 'err')
      }
    },
    async copyQrLink() {
      try {
        await navigator.clipboard.writeText(this.qr.link)
        this.showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞', 'ok')
      } catch (e) {
        this.showToast('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', 'err')
      }
    },
    async copyLink(link) {
      try {
        await navigator.clipboard.writeText(link)
        this.showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞', 'ok')
      } catch (e) {
        this.showToast('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É', 'err')
      }
    },
    showToast(text, type = 'ok') {
      this.toast.show = true
      this.toast.text = text
      this.toast.type = type
      setTimeout(() => {
        this.toast.show = false
      }, 3000)
    },
    getPlanName(plan) {
      const names = {
        'week': '–ù–µ–¥–µ–ª—è',
        'month': '–ú–µ—Å—è—Ü',
        'year': '–ì–æ–¥'
      }
      return names[plan] || plan
    },
    getPlanPrice(plan) {
      const prices = {
        'week': '‚ÇΩ100',
        'month': '‚ÇΩ250',
        'year': '‚ÇΩ2000'
      }
      return prices[plan] || '‚Äî'
    },
    getStatusText(status) {
      const statuses = {
        'active': '–ê–∫—Ç–∏–≤–µ–Ω',
        'expired': '–ò—Å—Ç—ë–∫',
        'pending': '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã'
      }
      return statuses[status] || status || '–ù–µ—Ç —Å—Ç–∞—Ç—É—Å–∞'
    },
    confirmRecreateProxy(accountId) {
      if (confirm('‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!\n\n–ü—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞:\n‚Ä¢ –°—Ç–∞—Ä—ã–µ —Å—Å—ã–ª–∫–∏ –∏ QR-–∫–æ–¥—ã –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å\n‚Ä¢ –í–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö\n‚Ä¢ –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è\n\n–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
        this.recreateProxy(accountId)
      }
    }
  },
  async mounted() {
    await this.loadMe()
  }
}).mount('#app')
</script>
</body>
</html>
